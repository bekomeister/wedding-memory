@{
    ViewBag.Title = "Görsel Yükle";
    var theme = ViewBag.Theme as string ?? "classic";
}

@functions {
    public string GetEventTypeWelcomeMessage(string eventType)
    {
        return eventType switch
        {
            "wedding" => "Düğünümüze Hoşgeldiniz",
            "engagement" => "Nişanımıza Hoşgeldiniz",
            "promise" => "Sözümüze Hoşgeldiniz",
            "circumcision" => "Sünnetimize Hoşgeldiniz",
            "henna" => "Kınamıza Hoşgeldiniz",
            _ => "Düğünümüze Hoşgeldiniz"
        };
    }

    public string GetEventTypeDescription(string eventType)
    {
        return eventType switch
        {
            "wedding" => "Mutluluğumuzu bizimle paylaştığınız için teşekkürlerimizi sunarız.",
            "engagement" => "Nişan törenimizde bizimle olduğunuz için teşekkürlerimizi sunarız.",
            "promise" => "Söz törenimizde bizimle olduğunuz için teşekkürlerimizi sunarız.",
            "circumcision" => "Sünnet törenimizde bizimle olduğunuz için teşekkürlerimizi sunarız.",
            "henna" => "Kına gecemizde bizimle olduğunuz için teşekkürlerimizi sunarız.",
            _ => "Mutluluğumuzu bizimle paylaştığınız için teşekkürlerimizi sunarız."
        };
    }
}

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
<style>
/* Tema CSS'leri */
.theme-classic .wedding-title { color: #0d47a1 !important; }
.theme-classic .wedding-subtitle { color: #0d6efd; }
.theme-classic .btn-primary { 
    background-color: #0d6efd; 
    border-color: #0d6efd; 
}
.theme-classic .card { border-color: #dee2e6; }

.theme-romantic .wedding-title { color: #c2185b !important; }
.theme-romantic .wedding-subtitle { color: #f06292; }
.theme-romantic .btn-primary { 
    background-color: #e91e63; 
    border-color: #e91e63; 
}
.theme-romantic .card { 
    border-color: #f8bbd9; 
    background: linear-gradient(135deg, #fff5f8 0%, #ffeef7 100%); 
}

.theme-elegant .wedding-title { color: #6a1b9a !important; }
.theme-elegant .wedding-subtitle { color: #ba68c8; }
.theme-elegant .btn-primary { 
    background-color: #9c27b0; 
    border-color: #9c27b0; 
}
.theme-elegant .card { 
    border-color: #e1bee7; 
    background: linear-gradient(135deg, #faf5ff 0%, #f3e5f5 100%); 
}

.theme-modern .wedding-title { color: #1565c0 !important; }
.theme-modern .wedding-subtitle { color: #64b5f6; }
.theme-modern .btn-primary { 
    background-color: #2196f3; 
    border-color: #2196f3; 
}
.theme-modern .card { 
    border-color: #bbdefb; 
    background: linear-gradient(135deg, #f8fbff 0%, #e3f2fd 100%); 
}

/* Hover efektleri */
.theme-romantic .btn-primary:hover { 
    background-color: #c2185b; 
    border-color: #c2185b; 
}
.theme-elegant .btn-primary:hover { 
    background-color: #7b1fa2; 
    border-color: #7b1fa2; 
}
.theme-modern .btn-primary:hover { 
    background-color: #1976d2; 
    border-color: #1976d2; 
}

/* Dosya önizleme stilleri */
.file-preview {
    max-width: 150px;
    max-height: 150px;
    object-fit: cover;
    border-radius: 8px;
    margin: 5px;
    border: 2px solid #dee2e6;
}

.file-info {
    font-size: 0.9rem;
    color: #6c757d;
    margin-top: 5px;
}

.progress {
    width: 100%;
    min-width: 120px;
    max-width: 100%;
    height: 25px;
    border-radius: 12px;
    margin: 0 auto;
}

@@media (max-width: 576px) {
    .progress {
        height: 18px;
        min-width: 80px;
    }
    .progress-bar {
        font-size: 0.9rem;
    }
}

.upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
}

.upload-area:hover {
    border-color: #0d6efd;
    background-color: #f8f9fa;
}

.upload-area.dragover {
    border-color: #0d6efd;
    background-color: #e3f2fd;
}

.upload-bg {
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    z-index: -1;
    background-position: center;
    background-size: cover;
    background-repeat: no-repeat;
    opacity: 0.5;
    pointer-events: none;
    transition: background-image 0.3s;
}
.upload-content { position: relative; z-index: 1; }

.theme-classic .wedding-title, .theme-romantic .wedding-title, .theme-elegant .wedding-title, .theme-modern .wedding-title,
.theme-classic .wedding-subtitle, .theme-romantic .wedding-subtitle, .theme-elegant .wedding-subtitle, .theme-modern .wedding-subtitle,
.text-with-shadow {
    text-shadow: 0 2px 8px rgba(0,0,0,0.25), 0 1px 2px rgba(0,0,0,0.18);
}

.wedding-title {
    font-family: 'Great Vibes', 'Dancing Script', cursive !important;
    font-size: 3.2rem;
    letter-spacing: 0.02em;
    font-weight: 400 !important;
    margin-bottom: 0.5rem;
}
@@media (min-width: 400px) {
    .wedding-title {
        font-size: 3.4rem;
    }
}
@@media (min-width: 576px) {
    .wedding-title {
        font-size: 5.2rem;
    }
}
@@media (min-width: 768px) {
    .wedding-title {
        font-size: 6.4rem;
    }
}
@@media (min-width: 992px) {
    .wedding-title {
        font-size: 7.6rem;
    }
}
.wedding-subtitle, .wedding-desc {
    font-family: 'Century Gothic', CenturyGothic, AppleGothic, sans-serif !important;
}
</style>

@if (!string.IsNullOrEmpty(ViewBag.BackgroundImageUrl as string))
{
    <div class="upload-bg"></div>
    <style>
        .upload-bg {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0;
            background-image: url('@ViewBag.BackgroundImageUrl');
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            opacity: 0.35;
            pointer-events: none;
            transition: background-image 0.3s;
        }
        @@media (max-width: 768px) {
            .upload-bg {
                background-position: center top;
                background-size: cover;
            }
        }
    </style>
}

<div class="pt-5 upload-content">
<div class="container d-flex justify-content-center align-items-center pt-5 pb-5 theme-@theme">
    <div class="row w-100 justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">
            <div class="text-center mb-3">
                <h1 class="wedding-title text-with-shadow">@ViewBag.BrideName &amp; @ViewBag.GroomName</h1>
                <h2 class="wedding-subtitle-responsive wedding-subtitle text-with-shadow">@GetEventTypeWelcomeMessage(ViewBag.EventType as string)</h2>
                <div class="mb-1 text-with-shadow wedding-desc" style="font-size:1.1rem; color:#222;">@GetEventTypeDescription(ViewBag.EventType as string)</div>
                <div class="mb-3 text-with-shadow wedding-desc" style="font-size:1.1rem; color:#222;">Birlikte nice güzel anılara!</div>
            </div>
            <div class="card shadow-lg border-0 w-100">
                <div class="card-body p-4">
                    <h5 class="text-center mb-4 wedding-subtitle" style="font-weight:600;">Yüklemeye Başla!</h5>
                    
                    @if (ViewBag.Error != null)
                    {
                        <div class="alert alert-danger">@ViewBag.Error</div>
                    }
                    @if (ViewBag.Success != null)
                    {
                        <div class="alert alert-success" id="successMessage">
                            @ViewBag.Success
                            @if (ViewBag.UploadedFiles != null)
                            {
                                <div class="mt-2">
                                    <strong>Yüklenen dosyalar:</strong>
                                    <ul class="mb-0 mt-1">
                                        @foreach (var file in ViewBag.UploadedFiles)
                                        {
                                            <li>@file</li>
                                        }
                                    </ul>
                                </div>
                            }
                        </div>
                    }
                    
                    <form asp-action="Index" asp-route-id="@ViewBag.WeddingId" method="post" enctype="multipart/form-data" id="uploadForm">
                        <div class="mb-3">
                            <input type="text" name="userName" class="form-control form-control-lg" placeholder="Ad soyad lütfen" required />
                        </div>
                        
                        <div class="mb-3">
                            <div class="upload-area" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt fa-2x mb-2" style="color: #6c757d;"></i>
                                <p class="mb-2">Dosyaları buraya sürükle veya tıklayarak seç</p>
                                <p class="small text-danger mb-0">Bir seferde en fazla 15 dosya yükleyebilirsin.</p>
                                <input type="file" name="files" class="form-control d-none" multiple required id="fileInput" accept=".jpg,.jpeg,.png,.gif,.webp,.mp4,.mov,.avi,.mkv,.webm" />
                            </div>
                        </div>
                        
                        <div id="filePreview" class="mb-3" style="display: none;">
                            <h6>Seçilen Dosyalar:</h6>
                            <div id="previewContainer" class="d-flex flex-wrap"></div>
                        </div>
                        
                        <div id="progressContainer" class="mb-3" style="display: none;">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                            </div>
                            <div class="text-center mt-2" id="progressText">Yükleniyor...</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 py-2 fs-5" id="submitBtn">Yükle</button>
                    </form>
                </div>
            </div>
        </div>
        </div>
    </div>
</div>
@{
	var currentUrl = $"{Context.Request.Scheme}://{Context.Request.Host}{Context.Request.Path}";
	var waNumber = "905398146320";
	var waUrl = "https://wa.me/" + waNumber + "?text=" + Uri.EscapeDataString(currentUrl);
}
<div class="text-center" style="color:#333; font-size:1.1rem; font-weight:500; margin-top:1.5rem; padding:1rem; background:rgba(255,255,255,0.95); border-radius:10px; box-shadow:0 2px 15px rgba(0,0,0,0.15); position:relative; z-index:10; margin-top: 3rem; justify-content: space-between;">
	Bir <a href="https://www.instagram.com/berkayzngn11/" target="_blank" style="color:#0d6efd; text-decoration:none; font-weight:600;">Berkay Zengin</a> projesidir.
	<!--<a href="https://www.instagram.com/berkayzngn11/" target="_blank" class="btn btn-outline-secondary btn-sm" style="margin-left:10px;"><i class="fab fa-instagram"></i></a>-->
	<a href="@waUrl" target="_blank" class="btn btn-success btn-sm" style="margin-left:6px;"><i class="fab fa-whatsapp"></i> </a>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const filePreview = document.getElementById('filePreview');
    const previewContainer = document.getElementById('previewContainer');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.querySelector('.progress-bar');
    const progressText = document.getElementById('progressText');
    const submitBtn = document.getElementById('submitBtn');
    const uploadForm = document.getElementById('uploadForm');

    // Drag & Drop işlemleri
    uploadArea.addEventListener('click', () => fileInput.click());
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        fileInput.files = e.dataTransfer.files;
        handleFileSelection();
    });

    fileInput.addEventListener('change', handleFileSelection);

    function handleFileSelection() {
        const files = fileInput.files;
        if (files.length > 15) {
            alert('Bir seferde en fazla 15 dosya yükleyebilirsin.');
            fileInput.value = '';
            previewContainer.innerHTML = '';
            filePreview.style.display = 'none';
            return;
        }
        if (files.length > 0) {
            previewContainer.innerHTML = '';
            filePreview.style.display = 'block';
            
            Array.from(files).forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'text-center me-3 mb-2';
                
                const fileSize = (file.size / (1024 * 1024)).toFixed(2);
                const fileExtension = file.name.split('.').pop().toLowerCase();
                
                if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(fileExtension)) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        fileDiv.innerHTML = `
                            <img src="${e.target.result}" class="file-preview" alt="${file.name}">
                            <div class="file-info">${file.name}<br>${fileSize} MB</div>
                        `;
                    };
                    reader.readAsDataURL(file);
                } else {
                    fileDiv.innerHTML = `
                        <div class="file-preview d-flex align-items-center justify-content-center bg-light">
                            <i class="fas fa-file fa-2x text-muted"></i>
                        </div>
                        <div class="file-info">${file.name}<br>${fileSize} MB</div>
                    `;
                }
                
                previewContainer.appendChild(fileDiv);
            });
        } else {
            filePreview.style.display = 'none';
        }
    }

    // Form submit işlemi
    uploadForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const files = fileInput.files;
        const userName = uploadForm.querySelector('input[name="userName"]').value;
        if (files.length === 0) {
            alert('Lütfen en az bir dosya seç.');
            return;
        }
        if (!userName || userName.trim() === '') {
            alert('Lütfen adını ve soyadını yaz.');
            return;
        }
        progressContainer.style.display = 'block';
        progressBar.style.width = '0%';
        progressText.textContent = 'Yükleniyor... %0';
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Yükleniyor...';

        const formData = new FormData();
        formData.append('userName', userName);
        for (let i = 0; i < files.length; i++) {
            formData.append('files', files[i]);
        }
        const uploadUrl = uploadForm.action;
        const xhr = new XMLHttpRequest();
        xhr.open('POST', uploadUrl, true);
        xhr.upload.onprogress = function(e) {
            if (e.lengthComputable) {
                const percent = Math.round((e.loaded / e.total) * 100);
                progressBar.style.width = percent + '%';
                progressText.textContent = 'Yükleniyor... %' + percent;
            }
        };
        xhr.onload = function() {
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Yükle';
            if (xhr.status === 200) {
                progressBar.style.width = '100%';
                progressText.textContent = 'Yükleme tamamlandı!';
                setTimeout(() => { window.location.reload(); }, 1200);
            } else {
                progressText.textContent = 'Yükleme sırasında hata oluştu.';
                alert('Yükleme sırasında hata oluştu. Lütfen tekrar deneyin.');
            }
        };
        xhr.onerror = function() {
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Yükle';
            progressText.textContent = 'Yükleme sırasında hata oluştu.';
            alert('Yükleme sırasında hata oluştu. Lütfen tekrar deneyin.');
        };
        xhr.send(formData);
    });

    // Başarı mesajını 5 saniye sonra gizle
    const successMsg = document.getElementById('successMessage');
    if (successMsg) {
        setTimeout(function() {
            successMsg.style.display = 'none';
        }, 5000);
    }
});
</script> 